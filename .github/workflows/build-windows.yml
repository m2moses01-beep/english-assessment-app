name: Build Windows Desktop App

on:
  push:
    branches: [ main, windows-support ]
  pull_request:
    branches: [ main, windows-support ]
  workflow_dispatch:  # Allows manual triggering

jobs:
  build-windows:
    runs-on: windows-latest  # GitHub's Windows server with 7GB RAM!

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: "3.19.0"
        channel: "stable"

    - name: Install Windows dependencies
      run: |
        # Install Visual Studio Build Tools
        choco install visualstudio2022community -y --package-parameters "--add Microsoft.VisualStudio.Workload.NativeDesktop --includeRecommended --quiet --norestart"
        choco install windows-sdk-10.0 -y

    - name: Flutter doctor
      run: flutter doctor -v

    - name: Get dependencies
      run: flutter pub get

    - name: Build Windows (Debug)
      run: flutter build windows --debug

    - name: Build Windows (Release)
      run: flutter build windows --release

    - name: Upload Debug build
      uses: actions/upload-artifact@v4
      with:
        name: windows-debug-build
        path: build/windows/runner/Debug/
        retention-days: 7

    - name: Upload Release build
      uses: actions/upload-artifact@v4
      with:
        name: windows-release-build
        path: build/windows/runner/Release/
        retention-days: 7
