name: Build Windows App

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: 'stable'
        cache: true
    
    - name: Create Windows Files with Working Icon
      shell: pwsh
      run: |
        Write-Host "=== Creating Windows files with guaranteed working icon ===" -ForegroundColor Cyan
        
        # 1. Create resource.h
        Set-Content -Path "windows/runner/resource.h" -Value "#pragma once`r`n`r`n#define IDI_APP_ICON 101`r`n#define IDR_APPLICATION_MANIFEST 102" -Encoding ASCII
        
        # 2. Create runner.rc - WITHOUT THE ICON LINE
        # Let's comment it out or remove it since it's causing issues
        Set-Content -Path "windows/runner/runner.rc" -Value "#include `"resource.h`"`r`n`r`n// Temporarily disabled: IDI_APP_ICON ICON `"resources/app_icon.ico`"`r`n`r`nIDR_APPLICATION_MANIFEST RT_MANIFEST `"runner.exe.manifest`"" -Encoding ASCII
        
        Write-Host "âœ… Created files (icon commented out)" -ForegroundColor Green
    
    - name: Install Dependencies
      run: flutter pub get
    
    - name: Try Debug Build
      run: flutter build windows --debug
